<UserControl x:Class="PlayniteUI.Controls.GamesImagesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:playniteUI="clr-namespace:PlayniteUI"
             xmlns:commands="clr-namespace:PlayniteUI.Commands"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">

    <UserControl.Resources>
        <playniteUI:EnumConverter x:Key="EnumConverter" />
        <playniteUI:OpacityBoolConverter x:Key="OpacityBoolConverter" />
        <playniteUI:LiteDBImageToImageConverter x:Key="LiteDBImageToImageConverter" />
        <playniteUI:NegateConverter x:Key="NegateConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <playniteUI:StringNullOrEmptyToVisibilityConverter x:Key="StringNullOrEmptyToVisibilityConverter" />
        <playniteUI:InvertableBooleanToVisibilityConverter x:Key="InvertableBooleanToVisibilityConverter" />
        <sys:Boolean x:Key="True">True</sys:Boolean>
        <sys:Boolean x:Key="False">False</sys:Boolean>
        <playniteUI:ValueConverterGroup x:Key="EnumCompVisibilityConverterInverted">
            <playniteUI:EnumConverter/>
            <playniteUI:NegateConverter/>
            <BooleanToVisibilityConverter/>
        </playniteUI:ValueConverterGroup>
        <DropShadowEffect x:Key="selectedShadow" Color="#FF9AB5FF" ShadowDepth="0" BlurRadius="20" RenderingBias="Quality"/>        
    </UserControl.Resources>

    <UserControl.CommandBindings>
        <CommandBinding Command="{x:Static commands:GenericCommands.ZoomInCmd}" Executed="ZoomIn_Executed" />
        <CommandBinding Command="{x:Static commands:GenericCommands.ZoomOutCmd}" Executed="ZoomOut_Executed" />
        <CommandBinding Command="{x:Static commands:GenericCommands.PlayGameCmd}" Executed="PlayGame_Executed" />
        <CommandBinding Command="{x:Static commands:GenericCommands.ShowDetailsCmd}" Executed="ShowDetails_Executed" />
    </UserControl.CommandBindings>

    <Grid Background="{StaticResource NormalBrushDark}">
        <DockPanel>
            <Border BorderThickness="0,1,0,0" BorderBrush="{StaticResource NormalBorderBrush}" DockPanel.Dock="Bottom">
                <StackPanel Margin="5" Orientation="Horizontal">
                    <Label Content="Zoom" DockPanel.Dock="Right" Margin="10,0,10,0"/>
                    <Slider Name="SliderZoom" SmallChange="1" Value="180" Maximum="260" Minimum="100"
                            IsSnapToTickEnabled="True" Width="150" DockPanel.Dock="Right" VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
            <Grid DockPanel.Dock="Top">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="0" Name="ColumnSplitter"/>
                    <ColumnDefinition Width="0" Name="ColumnDetails"/>
                </Grid.ColumnDefinitions>

                <ScrollViewer VerticalScrollBarVisibility="Auto" Focusable="False" IsDeferredScrollingEnabled="True" Grid.Column="0" Name="ScrollMain">
                    <ScrollViewer.InputBindings>
                        <MouseBinding Gesture="{x:Static playniteUI:MouseWheelGesture.CtrlUp}"
                                      Command="{x:Static commands:GenericCommands.ZoomInCmd}"
                                      CommandParameter="{Binding SelectedVisualElement}" />
                        <MouseBinding Gesture="{x:Static playniteUI:MouseWheelGesture.CtrlDown}"
                                      Command="{x:Static commands:GenericCommands.ZoomOutCmd}"
                                      CommandParameter="{Binding SelectedVisualElement}" />
                    </ScrollViewer.InputBindings>
                    
                    <ItemsControl Name="ItemsView" HorizontalAlignment="Center" 
                                  VirtualizingPanel.VirtualizationMode="Standard"
                                  VirtualizingPanel.IsVirtualizing="True"
                                  ScrollViewer.CanContentScroll="True"
                                  Margin="10">                        
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel FlowDirection="LeftToRight" IsItemsHost="true" Width="{Binding ActualWidth, ElementName=ScrollMain}" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.ContainerStyle>
                                    <Style TargetType="GroupItem">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="GroupItem">
                                                    <Expander Header="{Binding Name, TargetNullValue='None'}" IsExpanded="true">
                                                        <ItemsPresenter />
                                                    </Expander>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </GroupStyle.ContainerStyle>
                            </GroupStyle>
                        </ItemsControl.GroupStyle>
                        
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderThickness="3" CornerRadius="3" Background="Transparent" Margin="5">
                                    <Border.Style>
                                        <Style>
                                            <Style.Triggers>
                                                <Trigger Property="Border.IsMouseOver" Value="False">
                                                    <Setter Property="Border.BorderBrush" Value="Transparent"/>
                                                </Trigger>
                                                <Trigger Property="Border.IsMouseOver" Value="True">
                                                    <Setter Property="Border.BorderBrush" Value="{StaticResource IndicatorBrush}"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    
                                    <Image RenderOptions.BitmapScalingMode="Fant" Width="{Binding Path=Value, ElementName=SliderZoom}"
                                           Name="ImageViewImage" StretchDirection="Both"
                                           AutomationProperties.HelpText="{Binding Image, TargetNullValue=''}"
                                           AutomationProperties.Name="{Binding Name}">
                                        <Image.InputBindings>
                                            <MouseBinding MouseAction="LeftDoubleClick" Command="{x:Static commands:GenericCommands.PlayGameCmd}"/>
                                            <MouseBinding MouseAction="LeftClick" Command="{x:Static commands:GenericCommands.ShowDetailsCmd}"/>
                                        </Image.InputBindings>
                                        <Image.Source>
                                            <PriorityBinding>
                                                <Binding Path="Image" IsAsync="True" Mode="OneWay" Converter="{StaticResource LiteDBImageToImageConverter}" ConverterParameter="Image"/>
                                                <Binding Path="DefaultImage" Mode="OneTime"/>
                                            </PriorityBinding>
                                        </Image.Source>
                                    </Image>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Stretch" Background="{StaticResource NormalBorderBrush}"/>
                
                <Grid Grid.Column="2">
                    <playniteUI:GameDetails x:Name="GameDetails"/>
                    <Image Name="ImageCloseDetails" Source="/Images/close.png" Width="28" Margin="10" Cursor="Hand"
                           VerticalAlignment="Top" HorizontalAlignment="Right"
                           MouseLeftButtonUp="CloseDetailBorder_MouseLeftButtonDown"/>
                </Grid>
            </Grid>
        </DockPanel>
    </Grid>
</UserControl>
